!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("k_report",[],t):"object"==typeof exports?exports.k_report=t():e.k_report=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){function r(e){return e&&e.__esModule?e:{"default":e}}var o,i=n(5),a=r(i);"undefined"!=typeof e&&e.exports?e.exports=a["default"]:(o=function(){return a["default"]}.call(t,n,t,e),!(void 0!==o&&(e.exports=o))),window.KReport=a["default"]},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){n(this,e)}return r(e,null,[{key:"defaultOptions",value:function(){return{debug:!0,loadtime:{url:"http://k-inner-report.404mzk.com/v1/Creator_Loadtime_Controller/insert",classLoad:".k-report-classLoad",random:0},network:{url:"http://k-inner-report.404mzk.com/v1/Creator_Network_Controller/insert",timer:5e3,timeout:2,random:0},error:{url:"http://k-inner-report.404mzk.com/v1/Creator_Error_Controller/insert",random:0}}}},{key:"setOptions",value:function(t){if(void 0==t)return e.defaultOptions();for(var n=e.defaultOptions(),r=Object.keys(n),o=r.length-1;o>=0;o--)void 0===t[r[o]]&&(t[r[o]]=n[r[o]]);return e.Options=t,t}},{key:"getOptions",value:function(t){var n=e.options||e.defaultOptions();if(void 0==t)return n;if(void 0!=n[t])return n[t]}}]),e}();t["default"]=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(1),u=r(a),f=function(){function e(){o(this,e)}return i(e,null,[{key:"supportPerformance",value:function(){return"performance"in window&&"getEntriesByType"in window.performance&&window.performance.getEntriesByType("resource")instanceof Array}},{key:"now",value:function(){return e.supportPerformance()?window.performance.now().toFixed(2):Date.now()}},{key:"urlAppendData",value:function(t,n){return t+=t.indexOf("?")===-1?"?":"&",t+e.encodeFormData(n)}},{key:"encodeFormData",value:function(e){if(!e)return"";var t=[];for(var n in e)if(e.hasOwnProperty(n)&&"function"!=typeof e[n]){var r=e[n]instanceof Object?JSON.stringify(e[n]):e[n]+"";n=encodeURIComponent(n.replace("%20","+")),r=encodeURIComponent(r.replace("%20","+")),t.push(n+"="+r)}return t.join("&")}},{key:"offset",value:function(e){var t=void 0;if(e){e.getClientRects();return e.getClientRects().length?(t=e.getBoundingClientRect(),t.width||t.height?{top:t.top+window.pageYOffset-document.documentElement.clientTop,left:t.left+window.pageXOffset-document.documentElement.clientLeft}:t):{top:0,left:0}}}},{key:"log",value:function(e){u["default"].getOptions("debug")===!0&&console.log(e)}},{key:"getRandomInt",value:function(e,t){var n=Math.ceil(e),r=Math.floor(t);return Math.floor(Math.random()*(r-n+1))+n}}]),e}();t["default"]=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(1),u=r(a),f=n(2),d=r(f),l=function(){function e(){o(this,e),this.options=u["default"].getOptions(),this.sourceURL=[],this.findSourceURL()}return i(e,[{key:"findSourceURL",value:function(){for(var e=this.options.loadtime.classLoad,t=document.querySelectorAll(e),n=0;n<t.length;n++){var r=window.getComputedStyle(t[n],null).backgroundImage,o=t[n].src;if(d["default"].log("获取到绑定的class backgroundImage: "+r),d["default"].log("获取到绑定的class backgroundImage: "+o),this.isInATF(t[n])){if("string"==typeof r&&"none"!==r){var i=r.match(/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|&|-)+)/g);null!==i&&this.sourceURL.indexOf(i[0])===-1&&this.sourceURL.push(i[0])}void 0!==o&&this.sourceURL.indexOf(o)===-1&&this.sourceURL.push(o)}}}},{key:"isInATF",value:function(e){var t=document.documentElement.clientHeight,n=d["default"].offset(e).top;return d["default"].log("elemTop: "+n+" windowHeight: "+t),d["default"].log("资源是否在首屏"+(n<=t)),n<=t}}]),e}();t["default"]=l},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){n(this,e),this.message=[],this.setOnError()}return r(e,[{key:"setOnError",value:function(){var e=window.onerror,t=this;window.addEventListener("error",function(e){return void 0!==e.message||(t.message.push({_id:e.target.id,class_name:e.target.className,url:e.target.currentSrc||e.target.href,referer:location.href}),!0)},!0),window.onerror=function(n,r,o,i,a){var u=n.toLowerCase(),f="script error",d="";return null!==e&&e(n,r,o,i,a),u.indexOf(f)>-1?d={message:"Script Error: See Browser Console for Detail"}:(d={message:n,url:r,line:o,column:i,object:JSON.stringify(a),referer:location.href},t.message.push(d)),!1}}}]),e}();t["default"]=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(6),u=r(a),f=n(7),d=r(f),l=n(4),c=r(l),s=n(1),p=r(s),m=n(2),v=r(m),w=function(){function e(){o(this,e)}return i(e,[{key:"setOptions",value:function(e){var t=p["default"].setOptions(e),n=this;void 0!==t.loadtime&&(n.loadtime=new u["default"]),void 0!==t.network&&(n.network=new d["default"]),void 0!==t.error&&(n.error=new c["default"]),window.addEventListener("beforeunload",function(e){n.sendMessage()})}},{key:"sendMessage",value:function(){var e=p["default"].getOptions();if(void 0!==this.loadtime){var t=e.loadtime.random,n=new Image;if(t&&0!==v["default"].getRandomInt(0,t))return;n.src=v["default"].urlAppendData(e.loadtime.url,this.loadtime.getTime())}if(void 0!==this.network){var r=new Image,o=e.network.random,i={k_creator_entities:this.network.resourceTimeOut};if(o&&0!==v["default"].getRandomInt(0,o))return;r.src=v["default"].urlAppendData(e.network.url,i)}if(void 0!==this.error){var a=new Image,u=e.error.random,f={k_creator_entities:this.error.message};if(u&&0!==v["default"].getRandomInt(0,u))return;a.src=v["default"].urlAppendData(e.error.url,f)}}}]),e}();t["default"]=new w},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(2),u=r(a),f=n(3),d=r(f),l=function(){function e(){o(this,e),this.domContentLoadedTime=-1,this.atfed=-1,this.windowLoaded=-1,this.setDOMContentLoaded(),this.setWindowLoeded(),this.setAtfed()}return i(e,[{key:"getTime",value:function(){return{unload_event_start:this.unloadEventStart(),dom_content_loaded:this.domContentLoadedTime,atf:this.atfed,window_loaded:this.windowLoaded,referer:location.href}}},{key:"unloadEventStart",value:function(){return u["default"].supportPerformance()?performance.timing.unloadEventStart||performance.timing.fetchStart:u["default"].now()}},{key:"setDOMContentLoaded",value:function(){function e(){document.removeEventListener("DOMContentLoaded",e),window.removeEventListener("load",e),u["default"].supportPerformance()?t.domContentLoadedTime=performance.timing.domContentLoadedEventStart:t.domContentLoadedTime=u["default"].now()}var t=this;"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?u["default"].supportPerformance()?t.domContentLoadedTime=performance.timing.domContentLoadedEventStart:t.domContentLoadedTime=u["default"].now():(document.addEventListener("DOMContentLoaded",e),window.addEventListener("load",e))}},{key:"setAtfed",value:function(){var e=new d["default"],t=e.sourceURL,n=0,r=this,o=window.setTimeout(function(){if(0===t.length)return void window.clearInterval(o);for(var e=performance.getEntries(),i=e.length,a=n;a<i;a++)for(var u=t.length-1;u>=0;u--)e[a].name===t[u]&&e[a].responseEnd>=r.atfed&&(r.atfed=e[a].responseEnd.toFixed(2),t.splice(u,1));n=i},3e3)}},{key:"setWindowLoeded",value:function(){var e=this;window.addEventListener("load",function(){e.windowLoaded=Date.now()})}}]),e}();t["default"]=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(2),u=r(a),f=n(1),d=r(f),l=function(){function e(){o(this,e),this.resourceTimeOut=[],this.setTimer()}return i(e,[{key:"setTimer",value:function(){var e=d["default"].getOptions("network").timer,t=this;e=e<5e3?5e3:e;var n=setInterval(function(){u["default"].supportPerformance()&&t.performanceTimer()},e);return n}},{key:"performanceTimer",value:function(){for(var e=parseInt(d["default"].getOptions("network").timeout),t=performance.getEntries(),n=t.length,r=this.resourceStart||0,o=r;o<n;o++)if(t[o].duration>e){var i={duration:t[o].duration.toFixed(2),url:t[o].name,referer:location.href};this.resourceTimeOut.push(i)}this.resourceStart=n}}]),e}();t["default"]=l}])});